						       分布式限流计数器之滑动窗口计数
滑动窗口计数有很多使用场景，比如说限流防止系统雪崩。相比计数实现，滑动窗口实现会更加平滑，能自动消除毛刺。
滑动窗口原理是在每次有访问进来时，先判断前 N 个单位时间内的总访问量是否超过了设置的阈值，并对当前时间片上的请求数 +1。

　　上图每一个格式表示一个固定的时间（比如 1s），每个格子一个计数器，要获取前 3s 的请求量，就是对当前时间片 i ~ i-2 的时间片上计数器进行累加。
　　这种模式的实现的方式更加契合流控的本质意义，理解较为简单。但由于访问量的不可预见性，会发生单位时间的前半段大量请求涌入，而后半段则拒绝所有请求的情况（通常，需要可以将单位时间切的足够的小来缓解）；其次，很难确定这个阈值设置在多少比较合适，只能通过经验或者模拟（如压测）来进行估计，即使是压测也很难估计的准确。集群部署中每台机器的硬件参数不同，可能导致需要对每台机器的阈值设置的都不尽相同。同一台机子在不同的时间点的系统压力也不一样（比如晚上还有一些任务，或其他的一些业务操作的影响），能够承受的最大阈值也不尽相同，无法考虑的周全。
　　所以滑窗模式通常适用于对某一资源的保护的需求上，如对 db 的保护，对某一服务的调用的控制上。

代码实现思路：
　　每一个时间片（单位时间）就是一个独立的计数器，用以数组保存。将当前时间以某种方式（比如取模）映射到数组的一项中。每次访问先对当前时间片上的计数器 +1，再计算前 N 个时间片的访问量总合，超过阈值则限流。


转载:https://blog.csdn.net/zero__007/article/details/79263836